module ActionProvider
  class Exploit < BaseProvider
    def actions
      return [] unless current_actor.get_program_rating(MatrixProgram::EXPLOIT) > 0

      actions = []

      actions.concat(hacks_started)
      [HackingProcess::USER_ACCOUNT, HackingProcess::SECURITY_ACCOUNT, HackingProcess::ADMIN_ACCOUNT].each do |acc_type|
        actions.concat(
          (game_state.connectable_nodes - hacks_started.map(&:keys).flatten).map do |node|
            {
              node => HackingProcess.new(
                target_node: node,
                hacker: current_actor,
                attempts: 0,
                hacker_total_hits: 0,
                node_total_hits: 0,
                probing: false,
                account_type: acc_type
              )
            }
          end
        )
      end
      # actions.concat(current_actor.nodes_present_in.map { |node| { node => [] }}) # build the CRASH NODE details
      # actions.concat(current_actor.nodes_present_in.map { |node| { node => [] }}) # build the CRASH PROGRAM for every program on each ndoe details

      actions.compact
    end

    private

    def hacks_started
      return [] unless extended_actions[current_actor]
      extended_actions[current_actor]['exploit'] || []
    end
  end
end
